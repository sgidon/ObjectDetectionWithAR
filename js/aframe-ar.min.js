!function(e){function t(a){if(i[a])return i[a].exports;var s=i[a]={exports:{},id:a,loaded:!1};return e[a].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){i(4),i(3),i(2),i(1)},function(e,t){AFRAME.registerComponent("ar-raycaster",{dependencies:["raycaster"],schema:{x:{default:.5},y:{default:.5},el:{type:"selector"}},init:function(){this.raycaster=this.el.components.raycaster.raycaster,this.raycasterIntersectObjects=this.raycaster.intersectObjects.bind(this.raycaster),this.raycaster.intersectObjects=this.intersectObjects.bind(this)},update:function(e){this.data.el||this.el.sceneEl.object3D.el||(this.el.sceneEl.object3D.el=this.el.sceneEl)},intersectObjects:function(e,t){var i=this.raycasterIntersectObjects(e,t);return i.concat(this.hitAR())},hitAR:function(){var e=new THREE.Matrix4,t=new THREE.Vector3,i=new THREE.Quaternion,a=new THREE.Vector3,s=new THREE.Vector3;return function(){var r=this.el.sceneEl.components["three-ar"];if(!r||!r.arDisplay||!r.arDisplay.hitTest)return[];var n=r.arDisplay.hitTest(this.data.x,this.data.y);return!n||n.length<=0?[]:(e.fromArray(n[0].modelMatrix),e.decompose(t,i,a),this.el.object3D.getWorldPosition(s),[{distance:t.distanceTo(s),point:t,object:this.data.el&&this.data.el.object3D||this.el.sceneEl.object3D}])}}()})},function(e,t){AFRAME.registerComponent("ar",{schema:{takeOverCamera:{default:!0},cameraUserHeight:{default:!1}},dependencies:["three-ar-planes"],init:function(){this.el.setAttribute("three-ar",{takeOverCamera:this.data.takeOverCamera,cameraUserHeight:this.data.cameraUserHeight}),this.el.sceneEl.setAttribute("vr-mode-ui",{enabled:!1}),document.head.insertAdjacentHTML("beforeend","<style>html,body {background-color: transparent !important;}</style>")}})},function(e,t){AFRAME.registerComponent("three-ar-planes",{dependencies:["three-ar"],init:function(){this.planes={},this.anchorsAdded=[],this.anchorsAddedDetail={type:"added",anchors:this.anchorsAdded},this.anchorsUpdated=[],this.anchorsUpdatedDetail={type:"updated",anchors:this.anchorsUpdated},this.anchorsRemoved=[],this.anchorsRemovedDetail={type:"removed",anchors:this.anchorsRemoved}},tick:function(e,t){var i=new THREE.Vector3(1,1,1),a=(new THREE.Vector3,new THREE.Matrix4),s=new THREE.Vector3,r=(new THREE.Vector3,new THREE.Quaternion);new THREE.Euler(0,0,0,"YXZ");return function(e,t){var n=this.el.components["three-ar"];if(n&&n.arDisplay){var o,h=n.arDisplay,c=h.getPlanes?h.getPlanes():h.anchors_,l=[],d=[],p=[],u={};for(o=0;c&&o<c.length;o++){var m,E=c[o],f=(void 0!==E.identifier?E.identifier:E.id).toString(),D=E.timestamp;u[f]=!0;var y=!this.planes[f],R=void 0!==D;if(y||!R||D!==this.planes[f].timestamp){var m={identifier:f};if(void 0!==D&&(m.timestamp=D),E.modelMatrix||E.transform?m.modelMatrix=E.modelMatrix||E.transform:(s.fromArray(E.position),r.fromArray(E.orientation),i.set(1,1,1),a.compose(s,r,i),m.modelMatrix=a.elements.slice()),m.extent=E.extent,E.center&&(m.center=E.center),E.polygon?m.vertices=E.polygon:E.vertices&&(m.vertices=E.vertices),y)l.push(m);else if(R)d.push(m);else{if(AFRAME.utils.deepEqual(m,this.planes[f]))continue;d.push(m)}R?this.planes[f]=m:(this.planes[f]={identifier:m.identifier,modelMatrix:m.modelMatrix.slice(),extent:m.extent.slice()},m.center&&(this.planes[f].center=m.center.slice()),m.vertices&&(this.planes[f].vertices=m.vertices.slice()))}}var v=this;Object.keys(v.planes).forEach(function(e){u[e]||(p.push(v.planes[e]),delete v.planes[e])}),this.anchorsAdded=l,l.length>0&&(this.anchorsAddedDetail.anchors=l,this.el.emit("anchorsadded",this.anchorsAddedDetail)),this.anchorsUpdated=d,d.length>0&&(this.anchorsUpdatedDetail.anchors=d,this.el.emit("anchorsupdated",this.anchorsUpdatedDetail)),this.anchorsRemoved=p,p.length>0&&(this.anchorsRemovedDetail.anchors=p,this.el.emit("anchorsremoved",this.anchorsRemovedDetail))}}}()})},function(e,t){AFRAME.registerComponent("three-ar",{schema:{takeOverCamera:{default:!0},cameraUserHeight:{default:!1}},init:function(){this.posePosition=new THREE.Vector3,this.poseQuaternion=new THREE.Quaternion,this.poseEuler=new THREE.Euler(0,0,0,"YXZ"),this.poseRotation=new THREE.Vector3,this.projectionMatrix=new THREE.Matrix4,this.onceSceneLoaded=this.onceSceneLoaded.bind(this),this.el.sceneEl.hasLoaded?setTimeout(this.onceSceneLoaded):this.el.sceneEl.addEventListener("loaded",this.onceSceneLoaded)},tick:function(e,t){if(this.arDisplay&&this.arDisplay.getFrameData){this.arView&&this.arView.render(),this.frameData||(this.frameData=new VRFrameData),this.arDisplay.getFrameData(this.frameData),this.posePosition.fromArray(this.frameData.pose.position),this.poseQuaternion.fromArray(this.frameData.pose.orientation),this.poseEuler.setFromQuaternion(this.poseQuaternion),this.poseRotation.set(THREE.Math.RAD2DEG*this.poseEuler.x,THREE.Math.RAD2DEG*this.poseEuler.y,THREE.Math.RAD2DEG*this.poseEuler.z),this.arCamera&&this.data.cameraUserHeight&&(this.posePosition.y+=this.arCamera.el.components.camera.data.userHeight);var i=this.posePosition.x||this.posePosition.y||this.posePosition.z||this.poseQuaternion.x||this.poseQuaternion.y||this.poseQuaternion.z;if(i?this.poseLost!==!1&&(this.poseLost=!1,this.el.emit("poseFound")):this.poseLost!==!0&&(this.poseLost=!0,this.el.emit("poseLost",!1)),this.projectionMatrix.fromArray(this.frameData.leftProjectionMatrix),this.arCamera){var a=this.arCamera;a.el.setAttribute("position",this.posePosition),a.el.setAttribute("rotation",this.poseRotation),this.el.sceneEl.is("vr-mode")||(a.projectionMatrix=this.projectionMatrix)}}},takeOverCamera:function(e){this.arCamera=e,e.isARPerspectiveCamera=!0,e.vrDisplay=this.arDisplay,e.el.setAttribute("look-controls",{enabled:!1})},onceSceneLoaded:function(){var e=this;window.addEventListener("ardisplayconnect",function(){e.arDisplay||e.checkForARDisplay()}),this.checkForARDisplay()},checkForARDisplay:function(){var e=this;THREE.ARUtils.getARDisplay().then(function(t){if(e.arDisplay=t,t){var i=e.el.sceneEl;e.data.takeOverCamera&&setTimeout(function(){e.takeOverCamera(i.camera)}),i.renderer.alpha=!0,i.renderer.autoClearColor=THREE.ARUtils.isARKit(t),i.renderer.autoClearDepth=!0,e.arView=new THREE.ARView(t,i.renderer)}})},getPosition:function(){return this.arDisplay&&this.arDisplay.getFrameData?this.posePosition:null},getOrientation:function(){return this.arDisplay&&this.arDisplay.getFrameData?this.poseQuaternion:null},getRotation:function(){return this.arDisplay&&this.arDisplay.getFrameData?this.poseRotation:null},getProjectionMatrix:function(){return this.arDisplay&&this.arDisplay.getFrameData?this.projectionMatrix:null}})}]);